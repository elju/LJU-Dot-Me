// Generated by CoffeeScript 1.6.2
$(function() {
  var $blogContainer, Blog, blog;

  $blogContainer = $('#blog-container');
  Blog = (function() {
    function Blog(currentPage) {
      this.currentPage = currentPage != null ? currentPage : 'http://lju.me/blog/_site/';
    }

    Blog.prototype.updatePage = function(page) {
      this.currentPage = page;
      return $blogContainer.trigger('pageChange', [this]);
    };

    Blog.prototype.bootstrapBlog = function() {
      return $blogContainer.on('pageChange', this.loadNewPage);
    };

    Blog.prototype.fixLinks = function() {
      return $('#blog-container a[href*="blog/_site"]').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        blog.updatePage(this.href);
        return null;
      });
    };

    Blog.prototype.loadNewPage = function(e, blog) {
      var options, page, swapData;

      swapData = function(data) {
        $blogContainer.html(data.responseText);
        return blog.fixLinks();
      };
      page = blog.currentPage;
      options = {
        complete: swapData
      };
      return $.ajax(page, options);
    };

    return Blog;

  })();
  blog = new Blog();
  /*
  # Make an ajax call and get the new page content
  # After getting it, clear out the current page,
  # and replace with the new html.
  bootstrapBlog = () ->
      loadNewPage = (e) ->
          swapData = (data) ->
              $blogContainer.html(data.responseText)
              do fixLinks
  
          page = this.currentPage
          options = {complete: swapData}
          $.ajax(page, options)
  
      $blogContainer.on('pageChange', loadNewPage)
  
  fixLinks = () ->
      $('#blog-container a[href*="blog/_site"]').on('click', (e) ->
          e.preventDefault()
          e.stopPropagation()
          blog.updatePage(this.href)
          return null
      )
  */

  blog.bootstrapBlog();
  return blog.fixLinks();
});
